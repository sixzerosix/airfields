/**
 * REGISTRY TYPES
 * 
 * Типы для конфигурации полей с поддержкой conditional logic
 */

import type { ComponentType, ReactNode } from 'react'

// ============================================================================
// CONDITIONAL CONFIG
// ============================================================================

/**
 * Конфигурация условной видимости поля
 */
export interface VisibleWhenConfig {
	/**
	 * Имя поля, от которого зависит видимость
	 */
	field: string

	/**
	 * Простое условие: показать если поле равно значению
	 * @example { field: 'company_type', equals: 'legal_entity' }
	 */
	equals?: any

	/**
	 * Сложное условие: функция-предикат
	 * @example { field: 'status', condition: (val) => val === 'active' || val === 'pending' }
	 */
	condition?: (value: any) => boolean
}

/**
 * Конфигурация условной обязательности поля
 */
export interface RequiredWhenConfig {
	/**
	 * Имя поля, от которого зависит обязательность
	 */
	field: string

	/**
	 * Простое условие: обязательно если поле равно значению
	 */
	equals?: any

	/**
	 * Сложное условие: функция-предикат
	 */
	condition?: (value: any) => boolean
}

// ============================================================================
// FIELD CONFIG
// ============================================================================

/**
 * Конфигурация одного поля
 */
export interface FieldConfig {
	// ========================================================================
	// БАЗОВЫЕ НАСТРОЙКИ
	// ========================================================================

	/**
	 * Компонент для рендера поля
	 */
	component: ComponentType<any>

	/**
	 * Label для поля
	 */
	label?: string

	/**
	 * Placeholder
	 */
	placeholder?: string

	/**
	 * Дополнительные props для компонента
	 */
	props?: Record<string, any>

	// ========================================================================
	// SAVE SETTINGS
	// ========================================================================

	/**
	 * Режим сохранения
	 * - auto: автоматическое сохранение с debounce
	 * - manual: ручное сохранение через кнопки
	 * - hybrid: оба режима
	 */
	saveMode?: 'auto' | 'manual' | 'hybrid'

	/**
	 * Задержка debounce в мс (для auto mode)
	 */
	debounceMs?: number

	// ========================================================================
	// VALIDATION
	// ========================================================================

	/**
	 * Поле обязательно для заполнения
	 */
	required?: boolean

	/**
	 * Минимальная длина (для строк)
	 */
	minLength?: number

	/**
	 * Максимальная длина (для строк)
	 */
	maxLength?: number

	/**
	 * Регулярное выражение для валидации
	 */
	pattern?: RegExp

	/**
	 * Кастомная функция валидации
	 * @returns true если валидно, строка с ошибкой если невалидно
	 */
	validate?: (value: any) => boolean | string

	// ========================================================================
	// CONDITIONAL LOGIC (NEW!)
	// ========================================================================

	/**
	 * Условная видимость поля
	 * Поле будет скрыто если условие не выполнено
	 * 
	 * @example
	 * visibleWhen: { 
	 *   field: 'company_type', 
	 *   equals: 'legal_entity' 
	 * }
	 */
	visibleWhen?: VisibleWhenConfig

	/**
	 * Условная обязательность поля
	 * Поле станет required если условие выполнено
	 * 
	 * @example
	 * requiredWhen: { 
	 *   field: 'company_type', 
	 *   equals: 'legal_entity' 
	 * }
	 */
	requiredWhen?: RequiredWhenConfig

	// ========================================================================
	// UI CUSTOMIZATION
	// ========================================================================

	/**
	 * Дополнительный help text под полем
	 */
	helpText?: string

	/**
	 * Иконка для поля
	 */
	icon?: ReactNode

	/**
	 * CSS классы
	 */
	className?: string

	/**
	 * Поле только для чтения
	 */
	readOnly?: boolean

	/**
	 * Поле отключено
	 */
	disabled?: boolean
}

// ============================================================================
// ENTITY CONFIG
// ============================================================================

/**
 * Конфигурация всех полей сущности
 */
export interface EntityConfig {
	/**
	 * Название сущности (для UI)
	 */
	displayName?: string

	/**
	 * Иконка сущности
	 */
	icon?: ReactNode

	/**
	 * Конфигурация полей
	 */
	fields: Record<string, FieldConfig>
}

// ============================================================================
// REGISTRY
// ============================================================================

/**
 * Весь реестр конфигураций
 */
export type Registry = Record<string, EntityConfig>